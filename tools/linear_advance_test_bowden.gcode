; Linear Advance Calibration Test - Bowden
; K-Factor Range: 0.00 - 1.50
; Increments: 0.10
; Printer: Bowden Extruder
; Layer Height: 0.20mm
; Nozzle: 0.4mm
; Material: PLA recommended (works for PETG/ABS with temp adjustment)
;
; Usage:
;   1. Preheat printer to material temperature
;   2. Load filament
;   3. Print this file
;   4. Examine each section - find the one with most consistent lines
;   5. Fine-tune around that K value
;
; Each section labeled with K value. Look for:
;   - Consistent line width (no gaps or bulges at line starts/ends)
;   - Sharp corners without over/under extrusion
;   - Smooth surface without artifacts

; ============================================
; PREAMBLE - Printer Setup
; ============================================

G28 ; Home all axes
G1 Z5 F3000 ; Lift nozzle
M104 S200 ; Set extruder temp (PLA default - adjust for your material)
M140 S60 ; Set bed temp (PLA default - adjust for your material)
M190 S60 ; Wait for bed temp
M109 S200 ; Wait for extruder temp
G92 E0 ; Reset extruder position
M82 ; Absolute extrusion mode
M106 S0 ; Fan off

; ============================================
; ROW 1 - K = 0.00 to K = 0.50
; ============================================

; TEST SECTION 1 - K = 0.00 (LA Disabled)
M900 K0.00
G0 X20 Y20 F6000
G0 Z0.20 F3000
G92 E0

; Pattern: Speed changes to show LA effects
; Box 20x20mm with variable speed perimeters
G1 X40 Y20 E4 F1500 ; Bottom edge
G1 X40 Y40 E8 F1500 ; Right edge
G1 X20 Y40 E12 F1500 ; Top edge
G1 X20 Y20 E16 F1500 ; Left edge

; Second layer - varying speeds
G0 Z0.40
G1 X40 Y20 E20 F1500
G1 X40 Y40 E24 F3000 ; Faster
G1 X20 Y40 E28 F1500
G1 X20 Y20 E32 F3000 ; Faster

; Third layer - consistent speed
G0 Z0.60
G1 X40 Y20 E36 F2000
G1 X40 Y40 E40 F2000
G1 X20 Y40 E44 F2000
G1 X20 Y20 E48 F2000

; TEST SECTION 2 - K = 0.10
M900 K0.10
G0 X50 Y20 F6000
G0 Z0.20 F3000
G92 E0

G1 X70 Y20 E4 F1500
G1 X70 Y40 E8 F1500
G1 X50 Y40 E12 F1500
G1 X50 Y20 E16 F1500

G0 Z0.40
G1 X70 Y20 E20 F1500
G1 X70 Y40 E24 F3000
G1 X50 Y40 E28 F1500
G1 X50 Y20 E32 F3000

G0 Z0.60
G1 X70 Y20 E36 F2000
G1 X70 Y40 E40 F2000
G1 X50 Y40 E44 F2000
G1 X50 Y20 E48 F2000

; TEST SECTION 3 - K = 0.20
M900 K0.20
G0 X80 Y20 F6000
G0 Z0.20 F3000
G92 E0

G1 X100 Y20 E4 F1500
G1 X100 Y40 E8 F1500
G1 X80 Y40 E12 F1500
G1 X80 Y20 E16 F1500

G0 Z0.40
G1 X100 Y20 E20 F1500
G1 X100 Y40 E24 F3000
G1 X80 Y40 E28 F1500
G1 X80 Y20 E32 F3000

G0 Z0.60
G1 X100 Y20 E36 F2000
G1 X100 Y40 E40 F2000
G1 X80 Y40 E44 F2000
G1 X80 Y20 E48 F2000

; TEST SECTION 4 - K = 0.30
M900 K0.30
G0 X110 Y20 F6000
G0 Z0.20 F3000
G92 E0

G1 X130 Y20 E4 F1500
G1 X130 Y40 E8 F1500
G1 X110 Y40 E12 F1500
G1 X110 Y20 E16 F1500

G0 Z0.40
G1 X130 Y20 E20 F1500
G1 X130 Y40 E24 F3000
G1 X110 Y40 E28 F1500
G1 X110 Y20 E32 F3000

G0 Z0.60
G1 X130 Y20 E36 F2000
G1 X130 Y40 E40 F2000
G1 X110 Y40 E44 F2000
G1 X110 Y20 E48 F2000

; TEST SECTION 5 - K = 0.40
M900 K0.40
G0 X140 Y20 F6000
G0 Z0.20 F3000
G92 E0

G1 X160 Y20 E4 F1500
G1 X160 Y40 E8 F1500
G1 X140 Y40 E12 F1500
G1 X140 Y20 E16 F1500

G0 Z0.40
G1 X160 Y20 E20 F1500
G1 X160 Y40 E24 F3000
G1 X140 Y40 E28 F1500
G1 X140 Y20 E32 F3000

G0 Z0.60
G1 X160 Y20 E36 F2000
G1 X160 Y40 E40 F2000
G1 X140 Y40 E44 F2000
G1 X140 Y20 E48 F2000

; TEST SECTION 6 - K = 0.50
M900 K0.50
G0 X170 Y20 F6000
G0 Z0.20 F3000
G92 E0

G1 X190 Y20 E4 F1500
G1 X190 Y40 E8 F1500
G1 X170 Y40 E12 F1500
G1 X170 Y20 E16 F1500

G0 Z0.40
G1 X190 Y20 E20 F1500
G1 X190 Y40 E24 F3000
G1 X170 Y40 E28 F1500
G1 X170 Y20 E32 F3000

G0 Z0.60
G1 X190 Y20 E36 F2000
G1 X190 Y40 E40 F2000
G1 X170 Y40 E44 F2000
G1 X170 Y20 E48 F2000

; ============================================
; ROW 2 - K = 0.60 to K = 1.10
; ============================================

; TEST SECTION 7 - K = 0.60
M900 K0.60
G0 X20 Y60 F6000
G0 Z0.20 F3000
G92 E0

G1 X40 Y60 E4 F1500
G1 X40 Y80 E8 F1500
G1 X20 Y80 E12 F1500
G1 X20 Y60 E16 F1500

G0 Z0.40
G1 X40 Y60 E20 F1500
G1 X40 Y80 E24 F3000
G1 X20 Y80 E28 F1500
G1 X20 Y60 E32 F3000

G0 Z0.60
G1 X40 Y60 E36 F2000
G1 X40 Y80 E40 F2000
G1 X20 Y80 E44 F2000
G1 X20 Y60 E48 F2000

; TEST SECTION 8 - K = 0.70
M900 K0.70
G0 X50 Y60 F6000
G0 Z0.20 F3000
G92 E0

G1 X70 Y60 E4 F1500
G1 X70 Y80 E8 F1500
G1 X50 Y80 E12 F1500
G1 X50 Y60 E16 F1500

G0 Z0.40
G1 X70 Y60 E20 F1500
G1 X70 Y80 E24 F3000
G1 X50 Y80 E28 F1500
G1 X50 Y60 E32 F3000

G0 Z0.60
G1 X70 Y60 E36 F2000
G1 X70 Y80 E40 F2000
G1 X50 Y80 E44 F2000
G1 X50 Y60 E48 F2000

; TEST SECTION 9 - K = 0.80
M900 K0.80
G0 X80 Y60 F6000
G0 Z0.20 F3000
G92 E0

G1 X100 Y60 E4 F1500
G1 X100 Y80 E8 F1500
G1 X80 Y80 E12 F1500
G1 X80 Y60 E16 F1500

G0 Z0.40
G1 X100 Y60 E20 F1500
G1 X100 Y80 E24 F3000
G1 X80 Y80 E28 F1500
G1 X80 Y60 E32 F3000

G0 Z0.60
G1 X100 Y60 E36 F2000
G1 X100 Y80 E40 F2000
G1 X80 Y80 E44 F2000
G1 X80 Y60 E48 F2000

; TEST SECTION 10 - K = 0.90
M900 K0.90
G0 X110 Y60 F6000
G0 Z0.20 F3000
G92 E0

G1 X130 Y60 E4 F1500
G1 X130 Y80 E8 F1500
G1 X110 Y80 E12 F1500
G1 X110 Y60 E16 F1500

G0 Z0.40
G1 X130 Y60 E20 F1500
G1 X130 Y80 E24 F3000
G1 X110 Y80 E28 F1500
G1 X110 Y60 E32 F3000

G0 Z0.60
G1 X130 Y60 E36 F2000
G1 X130 Y80 E40 F2000
G1 X110 Y80 E44 F2000
G1 X110 Y60 E48 F2000

; TEST SECTION 11 - K = 1.00
M900 K1.00
G0 X140 Y60 F6000
G0 Z0.20 F3000
G92 E0

G1 X160 Y60 E4 F1500
G1 X160 Y80 E8 F1500
G1 X140 Y80 E12 F1500
G1 X140 Y60 E16 F1500

G0 Z0.40
G1 X160 Y60 E20 F1500
G1 X160 Y80 E24 F3000
G1 X140 Y80 E28 F1500
G1 X140 Y60 E32 F3000

G0 Z0.60
G1 X160 Y60 E36 F2000
G1 X160 Y80 E40 F2000
G1 X140 Y80 E44 F2000
G1 X140 Y60 E48 F2000

; TEST SECTION 12 - K = 1.10
M900 K1.10
G0 X170 Y60 F6000
G0 Z0.20 F3000
G92 E0

G1 X190 Y60 E4 F1500
G1 X190 Y80 E8 F1500
G1 X170 Y80 E12 F1500
G1 X170 Y60 E16 F1500

G0 Z0.40
G1 X190 Y60 E20 F1500
G1 X190 Y80 E24 F3000
G1 X170 Y80 E28 F1500
G1 X170 Y60 E32 F3000

G0 Z0.60
G1 X190 Y60 E36 F2000
G1 X190 Y80 E40 F2000
G1 X170 Y80 E44 F2000
G1 X170 Y60 E48 F2000

; ============================================
; ROW 3 - K = 1.20 to K = 1.50
; ============================================

; TEST SECTION 13 - K = 1.20
M900 K1.20
G0 X20 Y100 F6000
G0 Z0.20 F3000
G92 E0

G1 X40 Y100 E4 F1500
G1 X40 Y120 E8 F1500
G1 X20 Y120 E12 F1500
G1 X20 Y100 E16 F1500

G0 Z0.40
G1 X40 Y100 E20 F1500
G1 X40 Y120 E24 F3000
G1 X20 Y120 E28 F1500
G1 X20 Y100 E32 F3000

G0 Z0.60
G1 X40 Y100 E36 F2000
G1 X40 Y120 E40 F2000
G1 X20 Y120 E44 F2000
G1 X20 Y100 E48 F2000

; TEST SECTION 14 - K = 1.30
M900 K1.30
G0 X50 Y100 F6000
G0 Z0.20 F3000
G92 E0

G1 X70 Y100 E4 F1500
G1 X70 Y120 E8 F1500
G1 X50 Y120 E12 F1500
G1 X50 Y100 E16 F1500

G0 Z0.40
G1 X70 Y100 E20 F1500
G1 X70 Y120 E24 F3000
G1 X50 Y120 E28 F1500
G1 X50 Y100 E32 F3000

G0 Z0.60
G1 X70 Y100 E36 F2000
G1 X70 Y120 E40 F2000
G1 X50 Y120 E44 F2000
G1 X50 Y100 E48 F2000

; TEST SECTION 15 - K = 1.40
M900 K1.40
G0 X80 Y100 F6000
G0 Z0.20 F3000
G92 E0

G1 X100 Y100 E4 F1500
G1 X100 Y120 E8 F1500
G1 X80 Y120 E12 F1500
G1 X80 Y100 E16 F1500

G0 Z0.40
G1 X100 Y100 E20 F1500
G1 X100 Y120 E24 F3000
G1 X80 Y120 E28 F1500
G1 X80 Y100 E32 F3000

G0 Z0.60
G1 X100 Y100 E36 F2000
G1 X100 Y120 E40 F2000
G1 X80 Y120 E44 F2000
G1 X80 Y100 E48 F2000

; TEST SECTION 16 - K = 1.50
M900 K1.50
G0 X110 Y100 F6000
G0 Z0.20 F3000
G92 E0

G1 X130 Y100 E4 F1500
G1 X130 Y120 E8 F1500
G1 X110 Y120 E12 F1500
G1 X110 Y100 E16 F1500

G0 Z0.40
G1 X130 Y100 E20 F1500
G1 X130 Y120 E24 F3000
G1 X110 Y120 E28 F1500
G1 X110 Y100 E32 F3000

G0 Z0.60
G1 X130 Y100 E36 F2000
G1 X130 Y120 E40 F2000
G1 X110 Y120 E44 F2000
G1 X110 Y100 E48 F2000

; ============================================
; ACCELERATION TEST PATTERN
; Tests LA behavior during rapid direction changes
; ============================================

; Row of acceleration tests - Lower K range
M900 K0.00
G0 X20 Y150 F6000
G0 Z0.20 F3000
G92 E0
; Rapid back-and-forth pattern
G1 X60 Y150 E5 F3000
G1 X20 Y150 E10 F3000
G1 X60 Y150 E15 F3000
G1 X20 Y150 E20 F3000
G1 X60 Y150 E25 F3000
G1 X20 Y150 E30 F3000

M900 K0.20
G0 X70 Y150 F6000
G92 E0
G1 X110 Y150 E5 F3000
G1 X70 Y150 E10 F3000
G1 X110 Y150 E15 F3000
G1 X70 Y150 E20 F3000
G1 X110 Y150 E25 F3000
G1 X70 Y150 E30 F3000

M900 K0.40
G0 X120 Y150 F6000
G92 E0
G1 X160 Y150 E5 F3000
G1 X120 Y150 E10 F3000
G1 X160 Y150 E15 F3000
G1 X120 Y150 E20 F3000
G1 X160 Y150 E25 F3000
G1 X120 Y150 E30 F3000

M900 K0.60
G0 X170 Y150 F6000
G92 E0
G1 X210 Y150 E5 F3000
G1 X170 Y150 E10 F3000
G1 X210 Y150 E15 F3000
G1 X170 Y150 E20 F3000
G1 X210 Y150 E25 F3000
G1 X170 Y150 E30 F3000

; Row of acceleration tests - Higher K range
M900 K0.80
G0 X20 Y170 F6000
G92 E0
G1 X60 Y170 E5 F3000
G1 X20 Y170 E10 F3000
G1 X60 Y170 E15 F3000
G1 X20 Y170 E20 F3000
G1 X60 Y170 E25 F3000
G1 X20 Y170 E30 F3000

M900 K1.00
G0 X70 Y170 F6000
G92 E0
G1 X110 Y170 E5 F3000
G1 X70 Y170 E10 F3000
G1 X110 Y170 E15 F3000
G1 X70 Y170 E20 F3000
G1 X110 Y170 E25 F3000
G1 X70 Y170 E30 F3000

M900 K1.20
G0 X120 Y170 F6000
G92 E0
G1 X160 Y170 E5 F3000
G1 X120 Y170 E10 F3000
G1 X160 Y170 E15 F3000
G1 X120 Y170 E20 F3000
G1 X160 Y170 E25 F3000
G1 X120 Y170 E30 F3000

M900 K1.50
G0 X170 Y170 F6000
G92 E0
G1 X210 Y170 E5 F3000
G1 X170 Y170 E10 F3000
G1 X210 Y170 E15 F3000
G1 X170 Y170 E20 F3000
G1 X210 Y170 E25 F3000
G1 X170 Y170 E30 F3000

; ============================================
; FINISH
; ============================================

G0 Z10 F3000 ; Lift nozzle
G0 X0 Y200 F6000 ; Move to front
M104 S0 ; Turn off extruder
M140 S0 ; Turn off bed
M84 ; Disable motors
M106 S0 ; Fan off

; ============================================
; RESULTS GUIDE
; ============================================
; Sections are arranged in rows:
;
; Row 1 (Y20-40):  K=0.00, 0.10, 0.20, 0.30, 0.40, 0.50
; Row 2 (Y60-80):  K=0.60, 0.70, 0.80, 0.90, 1.00, 1.10
; Row 3 (Y100-120): K=1.20, 1.30, 1.40, 1.50
; Acceleration Row 1 (Y150): K=0.00, 0.20, 0.40, 0.60
; Acceleration Row 2 (Y170): K=0.80, 1.00, 1.20, 1.50
;
; Look for:
; - Most consistent line width
; - No gaps at line starts
; - No bulges at line ends
; - Clean corners
;
; After finding best K, fine-tune with smaller increments
; around that value (e.g., if K=0.50 looks best, test
; K=0.45, 0.48, 0.50, 0.52, 0.55)
;
; NOTE: Bowden K-factors vary significantly based on:
; - Bowden tube length (longer = higher K)
; - Filament flexibility (softer = lower K)
; - Hotend type (Volcano = different K)
; - Print speed (higher speeds = may need different K)